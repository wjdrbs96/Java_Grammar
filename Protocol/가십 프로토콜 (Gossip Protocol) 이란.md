## `가십 프로토콜 (Gossip Protocol) 이란?`

분산 데이터베이스에 구현된 Gossip 프로토콜을 간단하게 살펴보겠습니다.

가십 프로토콜은 분산 데이터베이스에서 많이 사용되는데 대표적으로 Cassandra가 가십 프로토콜을 사용합니다.

카산드라는 모든 노드가 동일하고 P2P 아키텍처를 가지며 Master-Slave 노드 개념이 없습니다. 모든 노드는 가십 프로토콜을 사용해서 통신합니다. 

즉, Gossip은 노드들이 데이터를 서로 일치시키기 위해 사용하는 메시지 시스템이고, 인접한 노드하고만 통신할 수 있다는 특징이 있습니다. 

인전합 노드들끼리 통신하기 때문에 바이러스 전파, 사람을 통해서 소문이 퍼지는 것과 유사하다고 할 수 있습니다.

<br>

## `가십 프로토콜 동작 원리`

가십 프로토콜은 분산형 장애 감지 솔루션이라고도 할 수 있습니다. 

![image](https://github.com/wjdrbs96/Today-I-Learn/assets/45676906/5a3bff5a-90c7-465d-b9a7-2a6ce72ecb0c)

| Member ID | Heartbeat counter | Time     |
|-----------|-------------------|----------|
| 1         | 10232             | 12:00:01 |
| 2         | 10224             | 12:00:10 |
| 3         | 9908              | 11:58:02 |
| 4         | 10237             | 12:00:20 |
| 5         | 10234             | 12:00:34 |
| 5         | 10238             | 12:00:29 |

- 각 노드는 멤버십 목록(membership list)를 유지합니다. 멤버십 목록은 각 멤버 ID와 그 Heartbeat counter 쌍의 목록이다.
- 각 노드는 주기적으로 자신의 Heartbeat counter를 증가시킨다.
- 각 노드는 무작위로 선정된 노드들에게 주기적으로 자기 Heartbeat counter 목록을 보낸다.
- Heartbeat counter 목록을 받은 노드는 멤버십 목록을 최신 값으로 갱신한다.
- 어떤 멤버의 Heartbeat counter 값이 지정된 시간 동안 갱신되지 않으면 해당 멤버는 장애 상태인 것으로 간주한다.

가십 프로토콜은 위처럼 동작합니다. 위의 그림처럼 3번 노드가 다운된 상황인데 좀 더 알아보겠습니다.
 
- 테이블 정보는 노드 1번의 멤버십 목록 상태다.
- 노드 1번은 3번 노드의 Heartbeat counter가 오랫동안 증가되지 않았다는 것을 발견한다.
- 노드 1번은 3번 노드의 Heartbeat counter 목록을 무작위로 선택된 다른 노드에게 전달한다.
- 노드 3번 Heartbeat counter가 오랫동안 증가되지 않았음을 발견한 모든 노드는 해당 노드를 장애 노드로 표시한다.

