## `Redis 확장과 분산 기법`

A 서버가 1초에 처리할 수 있는 요청을 100인데 서비스에서 필요한 성능은 300이라면 어떻게 할 수 있을까?

첫 번째로 A 서버의 사양을 3배 더 좋은 것으로 바꾸는 방법이 있을 수 있습니다. `스케일 업`이라고 하는데 이 방법은 RDB 에서는 가능하지만, Redis 에서는 불가능 합니다.

Redis는 싱글 쓰레드로 동작하기 때문에 하나의 인스턴스가 사용할 수 있는 최대 CPU의 개수가 하나이기에, CPU를 추가한다고 Redis 성능이 좋아지지 않습니다.

두 번째는 동일한 사양의 서버를 3대로 늘리는 방법입니다. `스케일 아웃` 이라고 하는데 이 방법은 통상적으로 NoSQL 에서 사용되는 방법입니다.

좀 더 들어가서 보면 `읽기 분산을 위한 복제(Replication)`과 `쓰기 분산을 위한 샤딩(sharding)`이 이에 해당 됩니다. 

- `복제`: 클라이언트가 어느 노드에 접근하더라도 동일한 데이터를 읽을 수 있도록 데이터를 각 노드에 복제하여 저장하는 기술
- `샤딩`: 데이터를 특정 조건에 따라 나누어 저장하는 것을 말한다. 1~5 까지는 A 노드에 6~10 까지는 B 노드에 분할 저장하는 방법을 샤딩이라 한다.
- `샤드`: 두 개의 노드를 사용하여 데이터를 분할 저장하였을 때 각 노드를 샤드라고 한다. 각 샤드가 복제를 사용하여 여러 개의 노드로 구성될 때에도 하나의 샤드로 취급한다.

<br>

## `복제`

복제는 다 알고 있듯이 동일한 데이터를 다중의 노드에 중복하여 저장하는 것을 말합니다. Redis는 MySQL 처럼 Mater-Slave 관계의 복제 개념을 사용합니다.

쓰기, 읽기 트래픽을 분산시켜서 Master 노드에서 쓰기 연산을 하고 Slave 에서 읽기 연산을 진행하여 노드의 부하를 분산 시킬 수 있습니다.

<br>

### `단일 복제`

<img width="722" alt="스크린샷 2024-05-26 오후 6 40 45" src="https://github.com/wjdrbs96/Today-I-Learn/assets/45676906/7a1c878a-a701-4bcd-b13a-816fc66dd874">

일반적인 DB에서 Master-Slave 관계와 크게 다를 것이 없습니다. 쓰기 연산은 Master 노드, 읽기 연산은 Slave 노드에서 진행하고 Master 노드에 쓰기 연산이 일어나면 Slave 노드로 실시간으로 복제하는 형태로 진행 됩니다.

<br>

### `다중 복제`

<img width="890" alt="스크린샷 2024-05-26 오후 6 48 07" src="https://github.com/wjdrbs96/Today-I-Learn/assets/45676906/48ba2797-fc75-43af-8e87-0ead16707cf9">

다중 복제는 말 그대로 Slave 노드를 N대 가지는 형태입니다. 읽기 트래픽이 많다면 위와 같은 구조롤 고려 해볼 수 있습니다.

이것 외에 계층형 복제, 듀얼 마스터 쓰기와 같은 구조도 상황에 맞게 사용할 수 있습니다.

<br>

## `샤딩`

샤딩은 다른 용어로 파티셔닝 이라고 부릅니다. 데이터를 특정 조건에 따라 나누어 저장하는 것을 말한다. 1~5 까지는 A 노드에 6~10 까지는 B 노드에 분할 저장하는 방법을 샤딩이라 합니다.

데이터를 분산에서 저장하게 되면 동일한 성능의 하드웨어를 사용할 때 더 많은 데이터를 저장할 수 있습니다. 예를들어, 10개의 데이터를 저장하는데 1G가 필요하다면, 5개의 데이터를 2개 노드에 나눠서 저장하면 노드당 500MB 정도의 메모리로 구성이 가능하다는 장점이 있습니다.

그리고 데이터를 분산해서 저장하기 떄문에 노드당 쓰기 연산을 분산해서 트래픽을 분산시킬 수 있다는 장점이 있습니다.

- `슈직 샤딩`: 관계형 데이터베이스의 테이블에 해당하는 정보를 노드별로 분할하는 방법 예를들어 사용자 정보는 A 노드, 친구 정보는 B 노드
- `범위 지정 샤딩`: 키를 특정 범위를 기준으로 분할하여 저장하는 방법이다. 예를 들어 1부터 1,000 까지 키가 있을 때 1 ~ 500은 A 노드, 501 ~ 1,000 까지는 B 노드에 저장한다.
- `해시 기반 샤딩`: 키를 해시 함수에 대입하여 결과값에 특정 연산을 가해 데이터의 위치를 결정하는 방법을 말한다.

<br>

## `Reference`

- [이것이 레디스다]()